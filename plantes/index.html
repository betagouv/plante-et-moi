<!DOCTYPE html>
<html>

<head>
	<title>Planter quoi ?</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <style type="text/css">
		.galery {
			margin: 0;
			display: block;
			height: 100%;
			width: 100%;
			background-color: #F3F3F3;
			position: relative;
			text-align: center;
			box-sizing: border-box;
			float: left;
		}
		.galery__card {
			margin: 10px;
			padding: 0px;
			width: 220px;
			border-radius: 2px;
			display: inline-block;
			vertical-align: top;
			background-color: white;
			position: relative;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
			font-family: "Helvetica", "Arial", sans-serif;
   			line-height: 1.5;
		}

		.galery__card--clickable {
			cursor: pointer;
		}
		
		.galery__card__image {
			position: relative;
			display: inline-block;
			max-width: 100%;
			max-height: 200px;
			border-radius: 2px 2px 0px 0px;
		}
		
		.galery__card__title {
			position: relative;
			display: inline-block;
			width: 100%;
			top: -40px;
			margin: 0px;
			text-align: center;
			font-weight: bold;
			color: white;
			background: rgba(63, 165, 53, 0.7);
			font-size: 22px;
		}

		.galery__card__subtitle {
			position: relative;
			display: inline-block;
			width: 100%;
			top: -41px;
			margin: 0px;
			text-align: center;
			font-weight: bold;
			color: white;
			background: rgba(63, 165, 53, 0.8);
			font-size: 15px;
		}
		
		.galery__card__description {
			position: relative;
			display: inline-block;
			margin: 20px 10px 10px 10px !important;
			padding: 0px;
			text-align: left;
			color: #555;
			font-size: 15px;
		}
		
		.galery__card__bottom {
			position: absolute;
			bottom: 0px;
			margin: 0px;
			width: 100%;
			font-weight: bold;
			border-radius: 0px 0px 2px 2px;
			left: 0px;
			display: block;
		}
		.invisible {
			display: none;
		}
		.tag {
			background-color: grey;
			padding: 6px;
			color: white;
			border-width: 0px;
		}
		.tag-selected {
			background-color: black;
		}
	</style>

</head>

<body>
<h1>Planter quoi ?</h1>
<div id="tag_filter" class="invisible">
	Type de projet : 
	<button class="tag tag-selected" onclick="filterPlantsByProject(this)">Tous</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Trottoirs</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Mobilier urbain</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Fa√ßades et murets</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Pieds d'arbres</button>
</div>
<div class="galery" id="galery">
		<div class="galery__card" id="item">
			<img class="galery__card__image" src=""/>
			<p class="galery__card__description"></p>
		</div>
</div>

<script>
	function filterPlantsByProject(elem) {
		var filter = elem.innerText;
		Array.from(document.getElementsByClassName("galery__card"))
		.forEach(function(plant){ 
			if(filter == "Tous") {
				plant.classList.remove("invisible")
			} else {
				if(Array.from(plant.getElementsByClassName("tag")).reduce(function(acc, tag){ 
					return acc || tag.innerHTML == filter
				}, false)) {
					plant.classList.remove("invisible")
				} else {
					plant.classList.add("invisible")
				}
			}
		})
		Array.from(document.getElementById("tag_filter").getElementsByClassName("tag"))
		.forEach(function(tag){ 
			tag.classList.remove("tag-selected");
		})
		elem.classList.add("tag-selected");
	}

    function showPlants(plants) {
        var card = document.getElementById("item");
        var newCards = plants.map(function(plant) {
            var newCard = card.cloneNode(true);
            Array.from(newCard.children).forEach(function(child) {
                if(child.className == "galery__card__image") {
                    child.src = plant["Wikipedia Thumb Url"];
                } else if (child.className == "galery__card__description") {
                    child.innerHTML = plant["Nom"]+"<br>"+plant["Nom latin"]+"<br><i class='material-icons' style='color: #FDB913; vertical-align: middle;'>wb_sunny</i> "+plant["Exposition"]+"<br><a href='"+plant["Wikipedia Page Url"]+"'>Wikipedia "+plant["Wikipedia Lang"]+"</a><br><span class='tag'>"+plant["Projet"]+"</span>";
                }
            });
            return newCard;
        });
        var galery = document.getElementById("galery");
        galery.removeChild(card);
        newCards.forEach(function(plant){
            galery.appendChild(plant);
        });
		document.getElementById("tag_filter").classList.remove("invisible");
    }

    var request = new XMLHttpRequest();
	request.open('GET', 'data/enhance-urban-plants.json', true);

	request.onload = function() {
	  if (request.status >= 200 && request.status < 400) {
	    // Success!
	    var data = JSON.parse(request.responseText);
	    showPlants(data)
	  } else {
	    // We reached our target server, but it returned an error

	  }
	};
	request.send();

</script>
</body>
</html>