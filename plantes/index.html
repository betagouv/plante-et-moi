<!DOCTYPE html>
<html>

<head>
	<title>Planter quoi ?</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <style type="text/css">
		body, html {
			margin: 0px;
			width: 100%;
			overflow-x: hidden;
		}
		.galery {
			padding: 10px;
			display: block;
			height: 100%;
			width: 100%;
			background-color: #F3F3F3;
			position: relative;
			text-align: center;
			box-sizing: border-box;
			float: left;
		}
		.galery__card {
			margin: 10px;
			padding: 0px;
			width: 600px;
			height: 300px;
			border-radius: 2px;
			display: inline-block;
			vertical-align: top;
			background-color: white;
			position: relative;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
			font-family: "Helvetica", "Arial", sans-serif;
   			line-height: 1.5;
		}

		.galery__card--clickable {
			cursor: pointer;
		}
		
		.galery__card__image {
			position: relative;
			background-repeat: no-repeat;
			background-position: center top;
			width: 300px;
			height: 300px;
			border-radius: 2px 2px 0px 0px;
			float: left;
			margin: 0px;
			background-size: cover;
		}
		
		.galery__card__description {
			position: relative;
			padding: 15px;
			text-align: left;
			color: #555;
			font-size: 15px;
			height: 300px;
			width: 300px;
			float: left;
			box-sizing: border-box;
			margin: 0px;
		}

		@media (max-width: 600px) {
			.galery__card {
				width: 300px;
				height: 600px;
			}
		}
		
		.galery__card__bottom {
			position: absolute;
			bottom: 0px;
			margin: 0px;
			width: 100%;
			font-weight: bold;
			border-radius: 0px 0px 2px 2px;
			left: 0px;
			display: block;
		}
		.invisible {
			display: none;
		}
		.tag {
			background-color: grey;
			padding: 6px;
			color: white;
			border-width: 0px;
			margin: 3px;
			line-height: 2.2;
		}
		.tag-selected {
			background-color: black;
		}
		h1 {
			font-size: 4em;
			text-align: center;
			font-family: "Helvetica", "Arial", sans-serif;
			margin: 0px;
			color: white;
		}
		h3 {
			font-size: 1.8em;
			margin-top: 0px;
			margin-bottom: 0px;
			line-height: 1.1;
		}
		h4 {
			font-size: 1.2em;
			font-weight: normal;
			font-style: italic;
			margin-top: 2px;
			margin-bottom: 10px;
		}
		.bee {
			position: absolute;
			top: 0px;
			left: 0px;
			background-color: #fbd53b;
			width: 60px;
			height: 60px;
			margin: 10px;
			-webkit-mask-image: url("img/icon_bee_transparent.svg");
			-webkit-mask-repeat: no-repeat;
		}

		.seeding, .flowering  {
			position: absolute;
			bottom: 0px;
			width: 50%;
			height: 80px;
			background-color: #e6e6e6;
			padding: 12px;
			box-sizing: border-box;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.seeding {
			left: 0px;
		}
		.flowering {
			right: 0px;
		}
		.seeding__text, .flowering__text {
			margin-left: 5px;
		}
		.header {
			width: 100%;
			background-color: #22b573;
			margin: 0px;
			padding: 10px;
		}
		.filters {
			width: 100%;
			padding: 20px;
			background-color: darkgrey;
		}
	</style>

</head>

<body>
	<div class="header">
		<h1>Planter quoi ?</h1>
	</div>
	<div class="filters">
<div id="tag_filter" class="invisible">
	Type de projet : 
	<button class="tag tag-selected" onclick="filterPlantsByProject(this)">Tous</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Trottoirs</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Mobilier urbain</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Façades et murets</button>
	<button class="tag" onclick="filterPlantsByProject(this)">Pieds d'arbres</button>
</div>
	</div>
<div class="galery" id="galery">
		<div class="galery__card" id="item">
			<div class="galery__card__image"></div>
			<p class="galery__card__description"></p>
			<div class="bee"></div>
		</div>
</div>

<script>
	function filterPlantsByProject(elem) {
		var filter = elem.innerText;
		Array.from(document.getElementsByClassName("galery__card"))
		.forEach(function(plant){ 
			if(filter == "Tous") {
				plant.classList.remove("invisible")
			} else {
				if(Array.from(plant.getElementsByClassName("tag")).reduce(function(acc, tag){ 
					return acc || tag.innerHTML == filter
				}, false)) {
					plant.classList.remove("invisible")
				} else {
					plant.classList.add("invisible")
				}
			}
		})
		Array.from(document.getElementById("tag_filter").getElementsByClassName("tag"))
		.forEach(function(tag){ 
			tag.classList.remove("tag-selected");
		})
		elem.classList.add("tag-selected");
	}

    function showPlants(plants) {
        var card = document.getElementById("item");
        var newCards = plants.map(function(plant) {
            var newCard = card.cloneNode(true);
            Array.from(newCard.children).forEach(function(child) {
                if(child.className == "galery__card__image") {
                    child.style.backgroundImage = "url('"+plant["Wikipedia Thumb Url"]+"')";
                } else if (child.className == "galery__card__description") {
					var description = "<h3>"+plant["Nom vernaculaire"]+"</h3><h4>"+plant["Genre"]+" "+plant["Espèce"]+"</h4><i class='material-icons' style='color: #603813; vertical-align: middle;'>line_style</i> Sol "+plant["Sol"].replace(/,/g, ", ")+"<br><i class='material-icons' style='color: #FDB913; vertical-align: middle;'>wb_sunny</i> "+plant["Exposition"].replace(/,/g, ", ");
					if (plant["Périodicité"] != "") {
						description += "<br><i class='material-icons' style='color: #666666; vertical-align: middle;'>rotate_right</i> Plante "+plant["Périodicité"];

					}
					//description += "<br><a href='"+plant["Wikipedia Page Url"]+"'>Wikipedia "+plant["Wikipedia Lang"]+"</a>";
					description += "<br>";
					plant["Types de projet"].split(",").forEach(function (tag) {
						description += "<span class='tag'>"+tag+"</span>";
					})

					description += "<div class='seeding'>";
					if(plant["Saison de Plantation"] != "") {
						description += "<i class='material-icons' style='color: #603813; vertical-align: middle;'>spa</i> <span class='seeding__text'>"+plant["Saison de Plantation"].replace(/,/g, ", ")+"</span>";
					}
					description += "</div>";
					description += "<div class='flowering'>";
					if(plant["Saison de Floraison"] != "") {
						description += "<i class='material-icons' style='color: #603813; vertical-align: middle;'>nature</i> <span class='flowering__text'>"+plant["Saison de Floraison"].replace(/,/g, ", ")+"</span>";
					}
					description += "</div>";
					description += "<br>";

                    child.innerHTML = description;
                } else if (child.className == "bee") {
					if (plant["Propriétés"].indexOf("mellifère") == -1) {
						child.style.display = "None";
					}
				}
            });
            return newCard;
        });
        var galery = document.getElementById("galery");
        galery.removeChild(card);
        newCards.forEach(function(plant){
            galery.appendChild(plant);
        });
		document.getElementById("tag_filter").classList.remove("invisible");
    }

    var request = new XMLHttpRequest();
	request.open('GET', 'data/enhance-urban-plants.json', true);

	request.onload = function() {
	  if (request.status >= 200 && request.status < 400) {
	    // Success!
	    var data = JSON.parse(request.responseText);
	    showPlants(data)
	  } else {
	    // We reached our target server, but it returned an error

	  }
	};
	request.send();

</script>
</body>
</html>