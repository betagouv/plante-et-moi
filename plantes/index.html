<!DOCTYPE html>
<html>

<head>
	<title>Planter quoi ?</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <style type="text/css">
		body, html {
			margin: 0px;
			width: 100%;
			height: 100%;
			overflow-x: hidden;
		}
		.galery {
			padding: 10px;
			display: block;
			min-height: 100%;
			width: 100%;
			background-color: #F3F3F3;
			position: relative;
			text-align: center;
			box-sizing: border-box;
		}
		.galery__container {
			width: 1860px;
			text-align: left;
			display: inline-block;
		}
		@media (max-width: 1860px) {
			.galery__container {
				width: 1240px;
			}
		}
		@media (max-width: 1240px) {
			.galery__container {
				width: 620px;
			}
		}

		.galery__card {
			margin: 10px;
			padding: 0px;
			width: 600px;
			height: 300px;
			border-radius: 2px;
			vertical-align: top;
			background-color: white;
			position: relative;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
			font-family: "Helvetica", "Arial", sans-serif;
   			line-height: 1.5;
			float: left;
			overflow: hidden;
		}

		.galery__card--clickable {
			cursor: pointer;
		}
		
		.galery__card__image {
			position: relative;
			background-repeat: no-repeat;
			background-position: center top;
			width: 300px;
			height: 300px;
			border-radius: 2px 2px 0px 0px;
			float: left;
			margin: 0px;
			background-size: cover;
		}

		.galery__card__short-description, .galery__card__long-description {
			position: relative;
			box-sizing: border-box;
			float: left;
			margin: 0px;
			padding: 15px;
			color: #555;
			font-size: 15px;
		}
		
		.galery__card__short-description {
			width: 300px;
			height: 300px;
		}
		.galery__card__long-description {
			position: absolute;
			padding-top: 70px;
			top: 0px;
			left: 0px;
			width: 300px;
			height: 300px;
			background-color: rgba(255, 255, 255, 0.9);
		}


		.galery__card__long-description, .galery__card .galery__card__short-description h4 {
			visibility: hidden;
		}

		.galery__card:hover .galery__card__long-description, .galery__card:hover .galery__card__short-description h4 {
			visibility: visible;
		}

		@media (max-width: 600px) {
			.galery__card {
				width: 300px;
				height: 600px;
			}
		}
		
		.galery__card__bottom {
			position: absolute;
			bottom: 0px;
			margin: 0px;
			width: 100%;
			font-weight: bold;
			border-radius: 0px 0px 2px 2px;
			left: 0px;
			display: block;
		}
		.invisible {
			display: none;
		}
		.tag {
			background-color: grey;
			padding: 6px;
			color: white;
			border-width: 0px;
			margin: 3px;
			line-height: 2.2;
		}
		.tag-selected {
			background-color: black;
		}
		h1 {
			font-size: 4em;
			text-align: center;
			font-family: "Helvetica", "Arial", sans-serif;
			margin: 0px;
			color: white;
		}
		h2 {
			font-size: 2em;
			text-align: center;
			font-family: "Helvetica", "Arial", sans-serif;
			color: white;
		}
		h3 {
			font-size: 1.8em;
			margin-top: 0px;
			margin-bottom: 0px;
			line-height: 1.1;
			max-width: 250px;
		}
		h4 {
			font-size: 1.2em;
			font-weight: normal;
			font-style: italic;
			margin-top: 2px;
			margin-bottom: 10px;
		}
		.bee {
			position: absolute;
			top: 0px;
			left: 0px;
			background-color: #fbd53b;
			width: 60px;
			height: 60px;
			margin: 10px;
			-webkit-mask-image: url("img/icon_bee_transparent.svg");
			-webkit-mask-repeat: no-repeat;
		}

		.seeding, .flowering  {
			position: absolute;
			bottom: 0px;
			width: 50%;
			height: 80px;
			background-color: #e6e6e6;
			padding: 12px;
			box-sizing: border-box;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.seeding {
			left: 0px;
		}
		.flowering {
			right: 0px;
		}
		.seeding__text, .flowering__text {
			margin-left: 5px;
		}
		.header {
			width: 100%;
			background-color: #22b573;
			margin: 0px;
			padding: 10px;
			box-sizing: border-box;
		}
		.filters, .types {
			width: 100%;
			background-color: darkgrey;
			box-sizing: border-box;
		}
		.filters {
			padding: 20px;
		}
		.types {
			min-height: 80%;
			width: 100%;
			margin: 0 auto;
			padding: 10px;
			text-align: center;
		}
		.save {
			position: absolute;
			top: 0px;
			right: 0px;
			color: black;
			font-size: 30px;
			margin: 10px;
			text-align: center;
			cursor: pointer;
			vertical-align: middle;
		}
		.save i {
			font-size: 30px;
		}
		.footer {
			padding: 15px;
			width: 100%;
			background-color: grey;
			color: #e6e6e6;
			box-sizing: border-box;
		}
		.type {
			height: 340px;
			width: 270px;
			display: inline-block;
			padding: 0px;
			margin: 10px;
			text-align: center;
			vertical-align: top;
			color: white;
			text-align: left;
		}
		.types__button {
			height: 210px;
			display: inline-block;
			padding: 20px;
			border-radius: 2px;
			vertical-align: top;
			background-color: grey;
			color: white;
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
			text-align: left;
			cursor: pointer;
		}
		.types__button:hover {
			background-color: #b2b2b2;
		}
		.types__button ul, .types__button b {
			visibility: hidden;
		}
		.types__button:hover ul, .types__button:hover b {
			visibility: visible;
		}
	</style>

</head>

<body>
	<div class="header">
		<h1>Planter quoi ?</h1>
	</div>
	<div class="types" id="types">
		<h2>Pour quel type de projet cherchez vous une plante ?</h2>
		<div class="type"> 
			<div class="types__button" onclick="filterPlantsByTag(this.getElementsByTagName('h3')[0].innerText)">
				<h3>Trottoirs</h3>
				<img src="http://demo.plante-et-moi.fr/arles/img/jardiniere.jpg" style="width: 100%;" />
			</div>
			<p style="display: inline-block;">Trottoir large et placette avec jardinières, bacs ou pots posés sur le sol.<br>
			<a href="#">En savoir plus</a>
			</p>
		</div>
		<div class="type"> 
			<div class="types__button" onclick="filterPlantsByTag(this.getElementsByTagName('h3')[0].innerText)">
				<h3>Mobilier urbain</h3>
				<img src="http://demo.plante-et-moi.fr/arles/img/rue_vegetalisee_1.jpg" style="width: 100%;" />
			</div>
			<p>
					Les garde-corps, les barrières dites "croix de Saint-André" ou" les potelets.<br>
			<a href="#">En savoir plus</a>
				</p>
		</div>
		<div class="type"> 
			<div class="types__button" onclick="filterPlantsByTag(this.getElementsByTagName('h3')[0].innerText)">
				<h3>Façades et murets</h3>
				<img src="http://demo.plante-et-moi.fr/dijon/img/pied%20de%20mur.JPG" style="width: 100%;" />
			</div>
			<p>
					Au sol: jardinière, bac, pot ou plantation directe à la base du mur (après un étude de faisabilité).<br>
			<a href="#">En savoir plus</a>
				</p>
		</div>
		<div class="type"> 
			<div class="types__button" onclick="filterPlantsByTag(this.getElementsByTagName('h3')[0].innerText)">
				<h3>Pieds d'arbres</h3>
				<img src="http://demo.plante-et-moi.fr/dijon/img/tour%20d'arbres.JPG" style="width: 100%;" />
			</div>
							<p>
					Culture en pleine terre sur le pourtour existant d'un arbre de rue.<br>
			<a href="#">En savoir plus</a>
				</p>
		</div>
	</div>
	<div class="filters invisible" id="filters">
		<div id="tag_filter">
			<b>Type de projet</b> : 
			<button class="tag tag-selected" onclick="filterPlantsByTag(this.innerText)">Tous</button>
			<button class="tag" onclick="filterPlantsByTag(this.innerText)">Trottoirs</button>
			<button class="tag" onclick="filterPlantsByTag(this.innerText)">Mobilier urbain</button>
			<button class="tag" onclick="filterPlantsByTag(this.innerText)">Façades et murets</button>
			<button class="tag" onclick="filterPlantsByTag(this.innerText)">Pieds d'arbres</button>
		</div>
		<div id="">
			<b>Exposition</b> :
			<label><input type="radio" name="exposition" value="Tous" checked='checked' onclick="updateViewFromFilter()">Pas de filtre</label>
			<label><input type="radio" name="exposition" value="soleil" onclick="updateViewFromFilter()"><i class='material-icons' style='color: #FDB913; vertical-align: middle;'>wb_sunny</i> soleil</label>
			<label><input type="radio" name="exposition" value="mi-ombre"
			onclick="updateViewFromFilter()"><i class='material-icons' style='color: grey; vertical-align: middle;'>brightness_medium</i> mi-ombre</label>
			<label>
			<input type="radio" name="exposition" value="ombre"
			onclick="updateViewFromFilter()"><i class='material-icons' style='color: black; vertical-align: middle;'>cloud_queue</i> ombre<label>
		</div>
		<div id="">
			<b>Périodicité</b> :
			<label><input type="radio" name="periodicity" value="Tous" checked='checked' onclick="updateViewFromFilter()">Pas de filtre</label>
			<label><input type="radio" name="periodicity" value="vivace"
			onclick="updateViewFromFilter()"> vivace</label>
			<label><input type="radio" name="periodicity" value="annuelle"
			onclick="updateViewFromFilter()"> annuelle</label>
			<label><input type="radio" name="periodicity" value="bisannuelle"
			onclick="updateViewFromFilter()"> bisannuelle</label>
		</div>
	</div>
	<div class="galery invisible" id="galery">
		<div class="galery__container" id="galery__container">
			<div class="galery__card" id="item">
				<div class="galery__card__image"></div>
				<p class="galery__card__short-description"></p>
				<p class="galery__card__long-description">Credit photo: Wikipedia</p>
				<div class="bee"></div>
				<p class="save" onclick="favorite(this);"><i class='material-icons'>star_border</i></p>
			</div>
		</div>
	</div>
	<div class="footer">
		Crédit photos : wikipedia/wikimedia<br>
		Crédit icone d'abeille : bee par alican de the Noun Project<br>
		Donnée de plantes fournit par la Mairie de Paris<br><br>
		Créé par Plante Et Moi : <a href="https://beta.gouv.fr/startup/biodiversite.html">https://beta.gouv.fr/startup/biodiversite.html</a><br>
	</div>


<script src="https://cdn.rawgit.com/madmurphy/cookies.js/c2eba5d7/cookies.js"></script>
<script>
	var favorites = [];
	var data = docCookies.getItem("favorites");
	if(data != "" && data != null) {
		favorites = data.split(",")
	}

	function favorite(saveNode) {
		var name = saveNode.parentNode.getElementsByTagName("h4")[0].innerText;
		if(saveNode.firstElementChild.innerText == "star") {
			saveNode.firstElementChild.innerText = "star_border";
			favorites.splice(favorites.indexOf(name),1);
		} else {
			saveNode.firstElementChild.innerText = "star";
			favorites.push(name);
		}
		docCookies.setItem("favorites", favorites.join(), 86400);
	}

	function filterPlantsByTag(filter, type) {
		Array.from(document.getElementById("tag_filter").getElementsByClassName("tag"))
		.forEach(function(tag){ 
			if(tag.innerText == filter) {
				tag.classList.add("tag-selected");
			} else {
				tag.classList.remove("tag-selected");
			}
		})
		updateViewFromFilter();
		document.getElementById("types").classList.add("invisible");
		document.getElementById("galery").classList.remove("invisible");
		document.getElementById("filters").classList.remove("invisible");
	}

	function updateViewFromFilter() {
		var filters = [ 
			{  
				name: "exposition", 
				value: document.querySelector('input[name="exposition"]:checked').value 
			},
			{  
				name: "tag",
				value: document.querySelector('#tag_filter .tag-selected').innerText 
			},
		/*	{ 
				name: "ground",
				value: document.querySelector('input[name="ground"]:checked').value
			},*/
			{
				name: "periodicity",
				value: document.querySelector('input[name="periodicity"]:checked').value
			}
		] 
		Array.from(document.getElementsByClassName("galery__card"))
		.forEach(function(plant){
			if(filters.reduce(function(acc, filter){ 
				return acc && matchFilter(plant, filter);
			}, true)) {
				plant.classList.remove("invisible");
			} else {
				plant.classList.add("invisible");
			}
		})
	}
	
	function matchFilter(plant, filter) {
		if(filter.value == "Tous") {
			return true;
		} 
		return Array.from(plant.getElementsByClassName(filter.name)).reduce(function(acc, elem){ 
					return acc || elem.innerText == filter.value;
			}, false);
	}

    function showPlants(plants) {
		var allGrounds = [];
        var card = document.getElementById("item");
        var newCards = plants.map(function(plant) {
            var newCard = card.cloneNode(true);
            Array.from(newCard.children).forEach(function(child) {
				var name = plant["Genre"]+" "+plant["Espèce"];
                if(child.className == "galery__card__image") {
                    child.style.backgroundImage = "url('"+plant["Wikipedia Thumb Url"]+"')";
                } else if (child.className == "galery__card__short-description") {
					var description = "<h3>"+plant["Nom vernaculaire"]+"</h3><h4>"+name+"</h4><i class='material-icons' style='color: #603813; vertical-align: middle;'>line_style</i> Sol ";
					
					var groundsList = plant["Sol"].split(',');
					allGrounds = allGrounds.concat(groundsList);
					description += groundsList.map(function(ground) {
						 return "<span class='ground'>"+ground+"</span>";
					}).join(', ');
					description += "<br>";
					plant["Exposition"].split(',').forEach(function(exposition) {
						if(exposition == "soleil") {
							description += "<i class='material-icons' style='color: #FDB913; vertical-align: middle;'>wb_sunny</i>";
						} else if(exposition == "mi-ombre") {
							description += "<i class='material-icons' style='color: grey; vertical-align: middle;'>brightness_medium</i>";
						} else if(exposition == "ombre") {
							description += "<i class='material-icons' style='color: black; vertical-align: middle;'>cloud_queue</i>";
						}
						description += " <span class='exposition'>"+exposition+"</span> ";
					})

					if (plant["Périodicité"] != "") {
						description += "<br><i class='material-icons' style='color: #666666; vertical-align: middle;'>rotate_right</i> Plante  <span class='periodicity'>"+plant["Périodicité"]+"</span>";

					}
					//description += "<br><a href='"+plant["Wikipedia Page Url"]+"'>Wikipedia "+plant["Wikipedia Lang"]+"</a>";
					description += "<br>";
					plant["Types de projet"].split(",").forEach(function (tag) {
						description += "<span class='tag'>"+tag+"</span>";
					})

					description += "<div class='seeding'>";
					if(plant["Saison de Plantation"] != "") {
						description += "<i class='material-icons' style='color: #603813; vertical-align: middle;'>spa</i> <span class='seeding__text'>"+plant["Saison de Plantation"].replace(/,/g, ", ")+"</span>";
					}
					description += "</div>";
					description += "<div class='flowering'>";
					if(plant["Saison de Floraison"] != "") {
						description += "<i class='material-icons' style='color: #603813; vertical-align: middle;'>nature</i> <span class='flowering__text'>"+plant["Saison de Floraison"].replace(/,/g, ", ")+"</span>";
					}
					description += "</div>";
					description += "<br>";

                    child.innerHTML = description;
                } else if (child.className == "galery__card__long-description") {
					var description = "Famille: "+plant["Famille"];
					if(plant["Floraison couleur"] != "") {
						description += "<br>Couleur de floraison : " + plant["Floraison couleur"];
					}
					if(plant["Hauteur"] != "") {
						description += "<br>Hauteur : " + plant["Hauteur"];
					}
					if(plant["Entretien"] != "") {
						description += "<br>Entretien : " + plant["Entretien"];
					}
					if(plant["Multiplication"] != "") {
						description += "<br>Multiplication : " + plant["Multiplication"];
					}

					description +="<br>Credit photo: <a href='"+plant["Wikipedia Page Url"]+"' target='_blank'>Wikipedia</a>"
                    child.innerHTML = description;
				} else if (child.className == "bee") {
					if (plant["Propriétés"].indexOf("mellifère") == -1) {
						child.style.display = "None";
					}
				} else if (child.className == "save") {
					if (favorites.indexOf(name) != -1) {
						child.firstElementChild.innerText = "star";
					}
				}
            });
            return newCard;
        });

		/*
		allGrounds = allGrounds.reduce((a, x) => ~a.indexOf(x) ? a : a.concat(x), []).sort();


		var groundFilterHTML = "<b>Sol</b> : <label><input type='radio' name='ground' value='Tous' onclick='updateViewFromFilter()' checked='checked'>Pas de filtre</label> ";
		allGrounds.forEach(function(ground){
			groundFilterHTML += "<label><input type='radio' name='ground' value='"+ground+"' onclick='updateViewFromFilter()'>"+ground+"</label> ";
		})
		document.getElementById("filters__grounds").innerHTML = groundFilterHTML; */

        var galery = document.getElementById("galery__container");
        galery.removeChild(card);
        newCards.forEach(function(plant){
            galery.appendChild(plant);
        });
		document.getElementById("tag_filter").classList.remove("invisible");
    }

    var request = new XMLHttpRequest();
	request.open('GET', 'data/enhance-urban-plants.json', true);

	request.onload = function() {
	  if (request.status >= 200 && request.status < 400) {
	    // Success!
	    var data = JSON.parse(request.responseText);
	    showPlants(data)
	  } else {
	    // We reached our target server, but it returned an error

	  }
	};
	request.send();

</script>
</body>
</html>