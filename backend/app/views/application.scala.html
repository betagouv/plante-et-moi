@(application: models.Application)
@import java.util.Locale

@main(s"Demande ${application.id.substring(0,2)}")  {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@@1.0.1/dist/leaflet.js"></script>

<style>
.demo-list-item {
    width: 550px;
}
.mdl-list__item-primary-content {
    font-weight: bold;
}
.map__leaflet {
    height: 250px;
}
</style>
}{
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid" style="text-align: center;">
    <div class="map__leaflet mdl-cell mdl-cell--12-col" id="map">
    </div>
</div>

<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid" style="text-align: center;">
    <div class="mdl-cell mdl-cell--4-col">
        <img src='@routes.Assets.versioned("images/examples/arbre_arles.jpg")' style="max-height: 300px;">
    </div>

    <ul class="demo-list-item mdl-list mdl-cell mdl-cell--8-col">
        <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Date de dépot
            </span>
            <span class="mdl-list__item-secondary-action">
                @application.date.toString("dd MMM YYYY", new Locale("fr"))
            </span>
        </li>
        <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Nom du demandeur
            </span>
            <span class="mdl-list__item-secondary-action">
                @application.name
            </span>
        </li>
        <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Courriel
            </span>
            <span class="mdl-list__item-secondary-action">
                @application.email
            </span>
        </li>
        <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Téléphone
            </span>
            <span class="mdl-list__item-secondary-action">
                @application.phone
            </span>
        </li>
        <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Avancement
            </span>
            <span class="mdl-list__item-secondary-action">
                @application.status
            </span>
        </li>
        <li class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      Type
    </span>
            <span class="mdl-list__item-secondary-action">
                @application._type
            </span>
        </li>
        <li class="mdl-list__item">
    <span class="mdl-list__item-primary-content">
      Adresse
    </span>
            <span class="mdl-list__item-secondary-action">
                @application.address
            </span>
        </li>
    </ul>


</div>
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
    <div class="mdl-cell mdl-cell--12-col mdl-grid">
        <h3 class="mdl-cell mdl-cell--12-col">Récapitulatif des avis</h3>
        <ul class="demo-list-three mdl-list mdl-cell mdl-cell--8-col mdl-cell--9-col-phone mdl-cell--2-offset-desktop">
            <li class="mdl-list__item mdl-list__item--three-line">
        <span class="mdl-list__item-primary-content">
          <i class="material-icons mdl-list__item-avatar">person</i>
          <span>Service de la voirie (Jean Paul Dupont)</span>
          <span class="mdl-list__item-text-body">
            Il n'y a aucune trap, ni conduite à ce niveau de la rue.
          </span>
        </span>
                <span class="mdl-list__item-secondary-content">
                    <i class="material-icons md-48">check</i>
        </span>
            </li>
        </ul>
    </div>
</div>
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
    <div class="mdl-cell mdl-cell--12-col mdl-grid">
    <form action="#" class="mdl-grid">
        <h3 class="mdl-cell mdl-cell--12-col">Mon avis d'agent de la voirie</h3>
        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-cell mdl-cell--5-col mdl-cell--1-offset" for="option-1">
            <input type="radio" id="option-1" class="mdl-radio__button" name="options" value="1" checked>
            <span class="mdl-radio__label">Favorable</span>
        </label>
        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-cell mdl-cell--5-col mdl-cell--1-offset" for="option-2">
            <input type="radio" id="option-2" class="mdl-radio__button" name="options" value="2">
            <span class="mdl-radio__label">Défavorable</span>
        </label>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
            <textarea class="mdl-textfield__input" type="text" rows= "5" id="sample5" style="width: 100%;"></textarea>
            <label class="mdl-textfield__label" for="sample5">Saisir mon commentaire...</label>
        </div>
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell mdl-cell--10-col mdl-cell--1-offset">
            Ajouter mon avis
        </button>
    </form>
    </div>
</div>
<script>
	var map = L.map('map', {
    	zoom: 13,
    	center: [0,0],
    	minZoom: 11,
    	layers: [
             L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoianVsaWVucGxhbnRlIiwiYSI6ImNpdzNiNzAwajAwMGUyem1vMXF5dDhraXQifQ.uARDuDENWMGtj67c36-qoQ', {
                attribution: "© <a href='https://www.mapbox.com/about/maps/'>Mapbox</a> © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> <strong><a href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a></strong>",
                minZoom: 10,
                maxZoom: 20
            })
	    ]
	});

	function addressesDataSource(term, response){
    		try { requestAddresses.abort(); } catch(e){}
			requestAddresses = new XMLHttpRequest();
			requestAddresses.open('GET', 'https://api-adresse.data.gouv.fr/search/?type=housenumber&q='+term+'&limit=30', true);
    		requestAddresses.onload = function() {
			  if (requestAddresses.status >= 200 && requestAddresses.status < 400) {
			    // Success!
			    var data = JSON.parse(requestAddresses.responseText);
			    response(data["features"]);
			  } else {
			    response([]);
			  }
			};
			requestAddresses.send();
    	}

	var requestAddresses;


    addressesDataSource("@application.address", function(responses) {
            var coord = responses[0]["geometry"]["coordinates"];
            var latlng = [coord[1],coord[0]]
            map.setView(latlng, 17);
	        L.marker(latlng, {
							draggable: false,
							clickable: false
						}).addTo(map)
	});
</script>
}